<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>Cesium Demo</title>
    <script type="text/javascript" src="Sandcastle-header.js"></script>
    <script type="text/javascript" src="ThirdParty/pako.min.js"></script>
    <script type="text/javascript" src="../../ThirdParty/requirejs-2.1.20/require.js"></script>
    <script type="text/javascript">
        if(typeof require === 'function') {
            var urlParams = new URLSearchParams(window.location.search);
            require.config({
                baseUrl : urlParams.has('gallery') ? '../../../' : '../../',
                waitSeconds : 120
            });
        }
    </script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<script type="text/javascript" src="Sandcastle-client.js"></script>
<script type="text/javascript" src="Sandcastle-helpers.js"></script>
<script type="text/javascript">
/*global pako,decodeBase64Data,embedInSandcastleTemplate */
if (typeof require === 'function') {
    require([
        'Source/Cesium'
    ], function(
        Cesium) {
         'use strict';
        window.Cesium = Cesium;
        loadDemoFromUrl();
    });
} else {
    loadDemoFromUrl();
}

function loadDemoFromUrl() {
    'use strict';
    // The helper functions script needs this.
    window.pako = pako;
    var defined = Cesium.defined;
    var loaderElement;
    var frameDelay = 30;
    var code;
    //Handle case where demo is in a sub-directory by modifying
    //the HTML to add a base href.
    var urlParams = new URLSearchParams(window.location.search);

    function update() {
        var width = getComputedStyle(loaderElement).getPropertyValue('width');
        var done = false;
        if (width === '12px') {
            frameDelay --;
            if (frameDelay <= 0) {
                done = true;
                var scriptElement = document.createElement('script');
                var isFirefox = navigator.userAgent.indexOf('Firefox/') >= 0;
                document.head.appendChild(scriptElement);
                scriptElement.innerHTML = embedInSandcastleTemplate(code, isFirefox);
            }
        }

        if (!done) {
            requestAnimationFrame(update);
        }
    }

    if (window.location.hash.indexOf('#c=') === 0) {
        if (urlParams.has('gallery')) {
            var galleryPath = urlParams.get('gallery');
            document.head.innerHTML = document.head.innerHTML + '<base href="' + galleryPath + '" />';
        }

        var base64String = window.location.hash.substr(3);
        var data = decodeBase64Data(base64String);
        var html = data.html;
        code = data.code;
        // Replace CSS URL since standalone is one level up from the usual bucket.html
        if (!urlParams.has('gallery')) {
            html = html.replace('../templates', 'templates');
        }
        html += '<div id="loader"></div>';
        html += '<style>#loader { width : 12px }</style>';

        // Add the HTML content
        var htmlElement = document.createElement('div');
        htmlElement.innerHTML = html;
        document.body.appendChild(htmlElement);
        // Add the JavaScript only when CSS has loaded
        loaderElement = document.querySelector('#loader');

        requestAnimationFrame(update);
    }
}
</script>
</body>
</html>
