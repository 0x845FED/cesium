<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta
      name="description"
      content="Use clipping regions to hide the area under a model or 3D tileset."
    />
    <meta name="cesium-sandcastle-labels" content="Beginner, Showcases" />
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script type="module" src="../load-cesium-es6.js"></script>
  </head>
  <body
    class="sandcastle-loading"
    data-sandcastle-bucket="bucket-requirejs.html"
  >
    <style>
      @import url(../templates/bucket.css);
    </style>
    <div id="cesiumContainer" class="fullSize"></div>
    <div id="loadingOverlay"><h1>Loading...</h1></div>
    <div id="toolbar"></div>
    <script id="cesium_sandcastle_script">
      window.startup = async function (Cesium) {
        "use strict";
        //Sandcastle_Begin
        // Grant CesiumJS access to your ion assets
        Cesium.Ion.defaultAccessToken =
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0NGZjOGMyYi1lMDI0LTRiODUtYTM5Zi0wY2ViYjk3MThlZjgiLCJpZCI6MTI0NzA0LCJpYXQiOjE3MDU0OTUwMTR9.HX9R4Kma0EwvnI6yUw6UXFCcjryAqoNIbnnT6WSG4T4";

        const viewer = new Cesium.Viewer("cesiumContainer", {
          timeline: false,
          animation: false,
          sceneModePicker: false,
          baseLayerPicker: false,
          // The globe does not need to be displayed,
          // since the Photorealistic 3D Tiles include terrain
          globe: false,
        });

        // Enable rendering the sky
        viewer.scene.skyAtmosphere.show = true;

        viewer.scene.debugShowFramesPerSecond = true;

        const currentTime = Cesium.JulianDate.fromIso8601(
          "2020-01-09T23:00:39.018261982600961346Z"
        );
        viewer.clock.currentTime = currentTime;

        const positions = Cesium.Cartesian3.fromDegreesArray(
          [
            [153.033834435422932, -27.569622925766826],
            [153.033836082527984, -27.569616899897252],
            [153.033905701988772, -27.569628939963906],
            [153.033999779170614, -27.569639093357882],
            [153.034202309593752, -27.56966617243279],
            [153.03426305344351, -27.569671813173326],
            [153.034283322127322, -27.569675762640919],
            [153.034455446437391, -27.569685354718629],
            [153.034536528397553, -27.569705105598853],
            [153.034617512346699, -27.569716073254352],
            [153.034698485585636, -27.569729941034879],
            [153.034911169361806, -27.569758927170604],
            [153.034994547792735, -27.569766637478562],
            [153.035002421117383, -27.569751086384443],
            [153.035047711913876, -27.56950458520145],
            [153.0351273419557, -27.56951755207259],
            [153.035128137527295, -27.569516188850756],
            [153.035268941306924, -27.569539249527736],
            [153.035289079814703, -27.569433407624185],
            [153.036509626575395, -27.569612959511449],
            [153.03657080500443, -27.569689162239438],
            [153.036590278201601, -27.569674904394706],
            [153.03658718770501, -27.569670031257374],
            [153.036587921295762, -27.569660764425088],
            [153.036611988203475, -27.569635929874647],
            [153.036622488531208, -27.569637867078438],
            [153.036632444924408, -27.569635213660263],
            [153.036652599687471, -27.569626605004999],
            [153.036690888929513, -27.569597653151884],
            [153.036691704118908, -27.569588592200951],
            [153.036713286907315, -27.569565962939361],
            [153.0367237395904, -27.569565267736415],
            [153.036733456043947, -27.569570074438055],
            [153.03662444978437, -27.569440712378022],
            [153.036455261449817, -27.569214639380672],
            [153.036250151981392, -27.568871457251596],
            [153.036190462795815, -27.568736830677771],
            [153.036204984570986, -27.568732516962243],
            [153.036125697120326, -27.568556726239159],
            [153.036102028003114, -27.568496577609309],
            [153.036026742755411, -27.568290495445179],
            [153.035989474787954, -27.568173536834941],
            [153.035810367889098, -27.567548668411231],
            [153.035915359329437, -27.567549010008943],
            [153.036088417483654, -27.568150451139083],
            [153.036124428754476, -27.568263491698382],
            [153.036199107815122, -27.568467889802477],
            [153.036221654791717, -27.568525182909458],
            [153.036249685359167, -27.568589613695636],
            [153.036344371171452, -27.568795034504308],
            [153.03637253338087, -27.568851649003456],
            [153.036407135142525, -27.568912406143838],
            [153.036380221272793, -27.568848796566112],
            [153.036298788556735, -27.568621952653306],
            [153.036254972263862, -27.568494768916533],
            [153.035942354517857, -27.567549249535134],
            [153.036084833092872, -27.567548673433283],
            [153.036456034102656, -27.568662875689427],
            [153.036459929738498, -27.56866221250063],
            [153.036681653481537, -27.569146269204118],
            [153.037058040896824, -27.569640547898004],
            [153.03731821726322, -27.569909072201288],
            [153.038161216668641, -27.570032331320071],
            [153.038257186864143, -27.56950666255695],
            [153.038252490806542, -27.569503970686572],
            [153.038239934117655, -27.569489983245159],
            [153.038202130563292, -27.569480155910043],
            [153.038196692262517, -27.569471456329591],
            [153.0382020876892, -27.569453301251109],
            [153.038212467942429, -27.569444364863507],
            [153.038212532276276, -27.569426248983813],
            [153.038220171636794, -27.569410540906521],
            [153.038222014862583, -27.569392471505466],
            [153.038228307896844, -27.569371575069528],
            [153.038224609037229, -27.569363029892546],
            [153.038230206144476, -27.569354035144318],
            [153.038235279224637, -27.569338816447925],
            [153.038241460158048, -27.569339375997771],
            [153.038238487441163, -27.56930597918236],
            [153.038268499786795, -27.569302978727706],
            [153.038292524722635, -27.569287614779913],
            [153.038304927822708, -27.569263206823234],
            [153.038323849139658, -27.569160961730304],
            [153.038326927104038, -27.569160961925565],
            [153.038455102391339, -27.56846838405092],
            [153.038453527234992, -27.568454165068847],
            [153.038469805355618, -27.56845560687232],
            [153.038472718819492, -27.568451549732977],
            [153.038475671867303, -27.568450220641598],
            [153.038506082978159, -27.568450785616616],
            [153.038515877445747, -27.568460355689826],
            [153.03854651613355, -27.568458118406692],
            [153.038571954770845, -27.568460378752114],
            [153.03858720229772, -27.568462590640905],
            [153.038627662976751, -27.568472881796346],
            [153.038668122091593, -27.568476228947585],
            [153.038668199142023, -27.568479174110738],
            [153.03870118556577, -27.568483240843619],
            [153.038702058127427, -27.5684809998139],
            [153.038707066154728, -27.56848173622954],
            [153.038707776132469, -27.568484893665715],
            [153.038779595192864, -27.56849373243746],
            [153.038799390656493, -27.568757459924733],
            [153.038808584636854, -27.569272972705797],
            [153.038776470396584, -27.569583979649359],
            [153.038769555785422, -27.569630335386652],
            [153.038768287558099, -27.569685988479865],
            [153.039218063166004, -27.569753320917737],
            [153.039194257247942, -27.569882582675191],
            [153.039425240247994, -27.569962771492278],
            [153.039674961908531, -27.570000076690949],
            [153.039666245611983, -27.570049131350309],
            [153.040260227745705, -27.570137859759058],
            [153.040199078304539, -27.570465641637675],
            [153.040318345371901, -27.570487207280898],
            [153.040530774515787, -27.570498001707495],
            [153.040879737135612, -27.570561093618068],
            [153.041019664886221, -27.570614038713408],
            [153.042615059898793, -27.570902599034653],
            [153.042658081376601, -27.570908667107975],
            [153.042686324446748, -27.57091491708216],
            [153.042820110250602, -27.570934547392898],
            [153.042860422199055, -27.570943566139363],
            [153.042901167124313, -27.570947627583074],
            [153.042968455371408, -27.570960269231563],
            [153.042969911561585, -27.570955608207758],
            [153.043144174800972, -27.570983124625922],
            [153.04329825751492, -27.57101385315574],
            [153.044026864162504, -27.571122545661826],
            [153.044025114641869, -27.571134268161202],
            [153.044027244615705, -27.571134802105437],
            [153.044030541647402, -27.5711443933052],
            [153.0440141254808, -27.57120383997465],
            [153.044013315280921, -27.571222199892276],
            [153.04400205455741, -27.571294420295583],
            [153.04399263873492, -27.571336592468196],
            [153.043990370893169, -27.571343321918508],
            [153.043984431417215, -27.57134461790189],
            [153.043981567380058, -27.571356787605485],
            [153.043193993318226, -27.571240998552174],
            [153.043144032433588, -27.571235276821827],
            [153.04311995292781, -27.571230113050049],
            [153.043025540939624, -27.57121623334773],
            [153.042976942452242, -27.571211906205473],
            [153.042956688802747, -27.571206549470887],
            [153.042932636443339, -27.571203659518069],
            [153.042905939117304, -27.571205993509366],
            [153.042880403784039, -27.5712222668839],
            [153.042867366370814, -27.57124780039867],
            [153.042848254048067, -27.571349541201577],
            [153.042834156798506, -27.571447843999046],
            [153.042821823496553, -27.571520021989674],
            [153.04282054269288, -27.571550555117931],
            [153.042807798603064, -27.571592265145259],
            [153.042797941548656, -27.571649837722877],
            [153.042775654086199, -27.571649243171226],
            [153.042738916908348, -27.571640806292063],
            [153.042718672352322, -27.571633914325567],
            [153.042600403782131, -27.571616894573257],
            [153.042590877372447, -27.571614131724154],
            [153.042637796562047, -27.571364389751338],
            [153.042659405443487, -27.571226668197856],
            [153.042659631737791, -27.571203933947857],
            [153.042655016031347, -27.571186294285948],
            [153.042638704863293, -27.571168404844535],
            [153.042617374991835, -27.571160584267325],
            [153.042597127764083, -27.571158326254885],
            [153.042576915484432, -27.571153823843822],
            [153.042536437901816, -27.571150209724813],
            [153.042495927412148, -27.571143958457871],
            [153.042475651552877, -27.571143109199841],
            [153.042374421788963, -27.571127328120639],
            [153.04233392236651, -27.571129017363269],
            [153.042293385256698, -27.571125631736834],
            [153.042232587811981, -27.571116603863736],
            [153.04219208639779, -27.571108992168011],
            [153.042080722881593, -27.571095183951424],
            [153.042072215154064, -27.571095184066195],
            [153.041938916225945, -27.571076383026554],
            [153.041857893336811, -27.571062741563495],
            [153.041695882699145, -27.571032581386202],
            [153.041622483479614, -27.571024125003525],
            [153.041533859764655, -27.571010065621298],
            [153.041371839225633, -27.570988263698041],
            [153.04120980913342, -27.570969422951052],
            [153.041047776026574, -27.570948328979611],
            [153.040966721445528, -27.570932859425181],
            [153.04088572033308, -27.570915278412929],
            [153.040804719661082, -27.570901745325553],
            [153.040723711843441, -27.570882082860983],
            [153.040690759122185, -27.570879743440351],
            [153.040619716641629, -27.570863221280735],
            [153.0402358752699, -27.570806921013926],
            [153.040204522895181, -27.5708096605339],
            [153.04017891957912, -27.570825933411395],
            [153.040165808384046, -27.570851459990465],
            [153.040145603954841, -27.570957326166027],
            [153.040118479665068, -27.570953363380976],
            [153.040116525010546, -27.570955386070231],
            [153.039998944635784, -27.570936400815057],
            [153.039997952531905, -27.570933690062724],
            [153.039944538634387, -27.570924971704478],
            [153.039963897414225, -27.570820858273212],
            [153.039960935343515, -27.570793017620883],
            [153.039942758302232, -27.570770296841275],
            [153.039914184059853, -27.570758733641245],
            [153.038271428823606, -27.570517150093686],
            [153.038252147419684, -27.570622873241579],
            [153.0385926646168, -27.57097133748228],
            [153.038568850444165, -27.570991413874644],
            [153.03844851714959, -27.571083763996572],
            [153.039763204700563, -27.572429060335796],
            [153.039990340417916, -27.57265586125267],
            [153.040359102873822, -27.572963251068519],
            [153.040603240307746, -27.573131851909046],
            [153.041063917897134, -27.573384402540846],
            [153.041358060513346, -27.573511956131899],
            [153.041488298626689, -27.573560204579412],
            [153.040952320267337, -27.573560578340327],
            [153.040679155471139, -27.573436835102743],
            [153.040029940717261, -27.572996734526406],
            [153.037695018140596, -27.570607183506915],
            [153.037675754360095, -27.570580832612713],
            [153.037655596782855, -27.570583921646993],
            [153.037643827692364, -27.570590836731061],
            [153.037637990897991, -27.570599928977135],
            [153.037606125898265, -27.570618716185184],
            [153.037577407659342, -27.570644898564115],
            [153.0375760189917, -27.570654032164825],
            [153.037565760370086, -27.570663140936446],
            [153.037544153233256, -27.570670251967538],
            [153.03753896474754, -27.57066645048673],
            [153.037520231415499, -27.570679978770301],
            [153.037344887598863, -27.570500546383112],
            [153.037339626059378, -27.57052264940425],
            [153.037197841599152, -27.5703775597025],
            [153.036726930490175, -27.570307588829721],
            [153.03672592347661, -27.570310307444274],
            [153.035766454946412, -27.570170921302612],
            [153.035686254129757, -27.570170651543595],
            [153.035678457144144, -27.570195768119952],
            [153.035629967897876, -27.570183172405937],
            [153.035609783085533, -27.570179799446205],
            [153.035589545206278, -27.570179797971193],
            [153.035528801385624, -27.570175287353695],
            [153.03550850092978, -27.570176127593083],
            [153.035468049528191, -27.570172465258562],
            [153.035447772528926, -27.570173590653294],
            [153.035427457362459, -27.57017245551771],
            [153.035386981603068, -27.570165691528711],
            [153.03536665407043, -27.570164548728172],
            [153.035346448939322, -27.57015948415685],
            [153.035323690251772, -27.570157792789665],
            [153.035265428061763, -27.570145378490743],
            [153.035230019571685, -27.570139742999665],
            [153.035174354335112, -27.570133539240587],
            [153.035163845893578, -27.570130659824606],
            [153.03508313282228, -27.570132561538678],
            [153.034992006120206, -27.57011435043216],
            [153.034961590042741, -27.570109547104074],
            [153.034941126778961, -27.570103542586974],
            [153.034940283964289, -27.570105082166943],
            [153.034785029104057, -27.570075885297793],
            [153.034646586657317, -27.570092798860259],
            [153.034613752429152, -27.570103204644674],
            [153.034607427514572, -27.570108483453978],
            [153.034605320122836, -27.570112354819059],
            [153.034588163212163, -27.570184508004569],
            [153.034566963798255, -27.570256678559485],
            [153.034561235181002, -27.570292789286398],
            [153.034541325784318, -27.570364974748603],
            [153.034534999499101, -27.570401048642175],
            [153.03452549509592, -27.570441697145089],
            [153.034515372331526, -27.570468750098485],
            [153.034489402130589, -27.570581552514891],
            [153.034458531461752, -27.570725925771001],
            [153.034446131449414, -27.570798097669368],
            [153.034438858748729, -27.570870268481272],
            [153.034434134555028, -27.57093540697765],
            [153.034429329951962, -27.571047578556239],
            [153.034429586732642, -27.571075815329738],
            [153.034437523059495, -27.571104530763048],
            [153.034459215337108, -27.571127541162607],
            [153.034020906452668, -27.57107450822647],
            [153.034052140734076, -27.571071192945631],
            [153.034077674328216, -27.571055253722363],
            [153.034090880704724, -27.57103001010692],
            [153.03414894235371, -27.570736274187663],
            [153.03415818875709, -27.570653578921377],
            [153.034170434706965, -27.570581358146452],
            [153.034191586838773, -27.570491141643206],
            [153.034203885570861, -27.570397675398493],
            [153.034213754193956, -27.570346740339428],
            [153.034224894589187, -27.570310635681118],
            [153.034256415315525, -27.570094107166629],
            [153.03425729577063, -27.570066351681845],
            [153.034249164117028, -27.57003947675263],
            [153.034214522963907, -27.569989729456537],
            [153.034165266664075, -27.56995097743042],
            [153.034105555552372, -27.569926529074642],
            [153.034010030976845, -27.569901608083534],
            [153.033918606061576, -27.569883916988825],
            [153.033837613887982, -27.569874331894034],
            [153.033783332449929, -27.569861601852679],
            [153.033782961186631, -27.569854326963551],
            [153.033793216593949, -27.569796260521905],
            [153.03381503433576, -27.569704292969835],
            [153.033813156257025, -27.569642784548492],
            [153.033816351590417, -27.569633693100155],
            [153.033823354824477, -27.56962460855301],
            [153.033827627493395, -27.569622167344193],
            [153.033834435422932, -27.569622925766826],
          ].flat(2)
        );

        const footprint = viewer.entities.add({
          polygon: {
            hierarchy: positions,
            material: Cesium.Color.WHITE.withAlpha(0.5),
            heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
          },
        });

        // Add a clipping region of target lot for development
        const clippingPolygons = new Cesium.ClippingPolygonCollection({
          polygons: [
            new Cesium.ClippingPolygon({
              positions: positions,
            }),
          ],
        });

        // Add Photorealistic 3D Tiles
        try {
          const googleTileset = await Cesium.createGooglePhotorealistic3DTileset(
            undefined,
            {
              clippingPolygons: clippingPolygons,
            }
          );
          viewer.scene.primitives.add(googleTileset);
        } catch (error) {
          console.log(`Error loading Photorealistic 3D Tiles tileset.
  ${error}`);
        }

        // Add tileset of proposed new building
        let buildingTileset;
        try {
          buildingTileset = await Cesium.Cesium3DTileset.fromIonAssetId(
            2424321
          );
          viewer.scene.primitives.add(buildingTileset);
        } catch (error) {
          console.log(`Error loading building tileset.
  ${error}`);
        }

        // Zoom to the new building location
        const cameraOffset = new Cesium.HeadingPitchRange(
          Cesium.Math.toRadians(95.0),
          Cesium.Math.toRadians(-18.0),
          600.0
        );
        viewer.zoomTo(buildingTileset, cameraOffset);
        viewer.homeButton.viewModel.command.beforeExecute.addEventListener(
          (e) => {
            e.cancel = true;
            viewer.zoomTo(buildingTileset, cameraOffset);
          }
        );

        // Enable toggling of new building visibility
        Sandcastle.addToggleButton("Show proposed building", true, function (
          checked
        ) {
          buildingTileset.show = checked;
        });

        Sandcastle.addToggleButton("Show footprint", true, function (checked) {
          footprint.show = checked;
        });

        // Enable toggling of target location highlight
        Sandcastle.addToggleButton("Clip target location", true, function (
          checked
        ) {
          clippingPolygons.enabled = checked;
        });

        Sandcastle.addToggleButton("Inverse clip", false, function (checked) {
          clippingPolygons.inverse = checked;
        });
        //Sandcastle_End
        Sandcastle.finishedLoading();
      };
      if (typeof Cesium !== "undefined") {
        window.startupCalled = true;
        window.startup(Cesium).catch((error) => {
          "use strict";
          console.error(error);
        });
      }
    </script>
  </body>
</html>
