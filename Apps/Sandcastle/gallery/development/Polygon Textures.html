<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta
      name="description"
      content="Draw a polygon or extruded polygon on the globe surface."
    />
    <meta name="cesium-sandcastle-labels" content="Development" />
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script
      type="text/javascript"
      src="../../../Build/CesiumUnminified/Cesium.js"
      nomodule
    ></script>
    <script type="module" src="../load-cesium-es6.js"></script>
  </head>
  <body
    class="sandcastle-loading"
    data-sandcastle-bucket="bucket-requirejs.html"
  >
    <style>
      @import url(../templates/bucket.css);
    </style>
    <div id="cesiumContainer" class="fullSize"></div>
    <div id="loadingOverlay"><h1>Loading...</h1></div>
    <div id="toolbar"></div>
    <script id="cesium_sandcastle_script">
      function startup(Cesium) {
        "use strict";
        //Sandcastle_Begin
        // Create the viewer.
        const viewer = new Cesium.Viewer("cesiumContainer");
        const scene = viewer.scene;

        // Example 1: Draw a textured polygon on the globe surface.

        // Create the polygon geometry. The positions here are
        // in counter clockwise order.
        let positions = Cesium.Cartesian3.fromDegreesArray([
          -115.4,
          37.4,
          -115.4,
          37,
          -115.2,
          37.1,
          -115.0,
          37,
          -115.0,
          37.4,
        ]);
        let textureCoordinates = {
          positions: [
            new Cesium.Cartesian2(0, 1),
            new Cesium.Cartesian2(0, 0),
            new Cesium.Cartesian2(0.5, 0),
            new Cesium.Cartesian2(1, 0),
            new Cesium.Cartesian2(1, 1),
          ],
        };
        // Create a geometry instance using the polygon geometry.
        const redPolygonInstance = new Cesium.GeometryInstance({
          geometry: Cesium.PolygonGeometry.fromPositions({
            positions: positions,
            vertexFormat:
              Cesium.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat,
            textureCoordinates: textureCoordinates,
          }),
        });

        // Example 2: Draw a textured polygon with holes.
        // Multiply nested holes are being decomposed into separate geometries, is what I'm guessing, and the texture coordinates are being copied.
        const polygonHierarchy = {
          positions: Cesium.Cartesian3.fromDegreesArray([
            -116.5,
            37.5,
            -116.5,
            37,
            -116,
            37,
            -116,
            37.5,
          ]),
          holes: [
            {
              positions: Cesium.Cartesian3.fromDegreesArray([
                -116.1,
                37.2,
                -116.1,
                37.15,
                -116.05,
                37.15,
                -116.05,
                37.2,
              ]),
            },
            {
              positions: Cesium.Cartesian3.fromDegreesArray([
                -116.35,
                37.35,
                -116.35,
                37.15,
                -116.15,
                37.15,
                -116.15,
                37.35,
              ]),
              holes: [
                {
                  positions: Cesium.Cartesian3.fromDegreesArray([
                    -116.3,
                    37.3,
                    -116.3,
                    37.2,
                    -116.2,
                    37.2,
                    -116.2,
                    37.3,
                  ]),
                  holes: [
                    {
                      positions: Cesium.Cartesian3.fromDegreesArray([
                        -116.27,
                        37.27,
                        -116.27,
                        37.23,
                        -116.23,
                        37.23,
                        -116.23,
                        37.27,
                      ]),
                    },
                  ],
                },
              ],
            },
          ],
        };
        textureCoordinates = {
          positions: [
            new Cesium.Cartesian2(0, 1),
            new Cesium.Cartesian2(0, 0),
            new Cesium.Cartesian2(0.5, 0),
            new Cesium.Cartesian2(0.5, 1),
          ],
          holes: [
            {
              positions: [
                new Cesium.Cartesian2(0.4, 0.4),
                new Cesium.Cartesian2(0.4, 0.3),
                new Cesium.Cartesian2(0.45, 0.3),
                new Cesium.Cartesian2(0.45, 0.4),
              ],
            },
            {
              positions: [
                new Cesium.Cartesian2(0.15, 0.7),
                new Cesium.Cartesian2(0.15, 0.3),
                new Cesium.Cartesian2(0.35, 0.3),
                new Cesium.Cartesian2(0.35, 0.7),
              ],
              holes: [
                {
                  positions: [
                    new Cesium.Cartesian2(0.2, 0.6),
                    new Cesium.Cartesian2(0.2, 0.4),
                    new Cesium.Cartesian2(0.3, 0.4),
                    new Cesium.Cartesian2(0.3, 0.6),
                  ],
                  holes: [
                    {
                      positions: [
                        new Cesium.Cartesian2(0.23, 0.54),
                        new Cesium.Cartesian2(0.23, 0.46),
                        new Cesium.Cartesian2(0.27, 0.46),
                        new Cesium.Cartesian2(0.27, 0.54),
                      ],
                    },
                  ],
                },
              ],
            },
          ],
        };
        // Create a geometry instance using the polygon geometry.
        const bluePolygonInstance = new Cesium.GeometryInstance({
          geometry: new Cesium.PolygonGeometry({
            polygonHierarchy: polygonHierarchy,
            vertexFormat:
              Cesium.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat,
            textureCoordinates: textureCoordinates,
          }),
        });

        // Example 3: Draw a textured extruded polygon.

        // To extrude, use the extruded height option to specify
        // the height of the polygon geometry.
        positions = Cesium.Cartesian3.fromDegreesArray([
          -117.5,
          37.5,
          -117.25,
          37.0,
          -117.0,
          37.5,
        ]);
        textureCoordinates = {
          positions: [
            new Cesium.Cartesian2(0, 1),
            new Cesium.Cartesian2(0, 0),
            new Cesium.Cartesian2(1, 0),
          ],
        };
        const greenPolygonInstance = new Cesium.GeometryInstance({
          geometry: Cesium.PolygonGeometry.fromPositions({
            positions: positions,
            extrudedHeight: 50000,
            vertexFormat:
              Cesium.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat,
            textureCoordinates: textureCoordinates,
          }),
        });

        // Example 4: Draw a textured extruded polygon with per position heights.

        // It is clear that the walls are consuming texture coordinates, but how is unclear. There are 16 pairs of texture coordinates requested for an extruded quadrilateral.

        positions = Cesium.Cartesian3.fromDegreesArrayHeights([
          -118.5,
          37.5,
          75000,
          -118.5,
          37.0,
          50000,
          -118.0,
          37.0,
          25000,
          -118.0,
          37.5,
          50000,
        ]);
        textureCoordinates = {
          positions: [
            new Cesium.Cartesian2(0.5, 1),
            new Cesium.Cartesian2(0, 0.5),
            new Cesium.Cartesian2(0.5, 0),
            new Cesium.Cartesian2(1, 0.5),
          ],
        };
        // Set the perPositionHeight option to true for the polygon
        // to use the heights each position.  In this case, we are
        // also setting extrudedHeight to zero for the polygon
        // to be extruded down to the globe surface.
        const orangePolygonInstance = new Cesium.GeometryInstance({
          geometry: Cesium.PolygonGeometry.fromPositions({
            positions: positions,
            extrudedHeight: 0,
            vertexFormat:
              Cesium.MaterialAppearance.MaterialSupport.TEXTURED.vertexFormat,
            perPositionHeight: true,
            textureCoordinates: textureCoordinates,
          }),
        });

        // Add each polygon instance to primitives.
        scene.primitives.add(
          new Cesium.Primitive({
            geometryInstances: [
              redPolygonInstance,
              greenPolygonInstance,
              bluePolygonInstance,
              orangePolygonInstance,
            ],
            appearance: new Cesium.MaterialAppearance({
              material: new Cesium.Material({
                fabric: {
                  type: "Image",
                  uniforms: {
                    image: "../images/Cesium_Logo_Color.jpg",
                  },
                },
              }),
              materialSupport:
                Cesium.MaterialAppearance.MaterialSupport.TEXTURED,
              translucent: false,
            }),
          })
        );

        // Ground primitive: doesn't work.

        positions = Cesium.Cartesian3.fromDegreesArray([
          -119.5,
          37.5,
          -119.5,
          37.0,
          -119.0,
          37.0,
          -119.0,
          37.5,
        ]);

        scene.primitives.add(
          new Cesium.GroundPrimitive({
            geometryInstances: new Cesium.GeometryInstance({
              geometry: new Cesium.PolygonGeometry({
                polygonHierarchy: { positions: positions },
                textureCoordinates: textureCoordinates,
              }),
            }),
            appearance: new Cesium.EllipsoidSurfaceAppearance({
              aboveGround: false,
              material: new Cesium.Material({
                fabric: {
                  type: "Image",
                  uniforms: {
                    image: "../images/Cesium_Logo_Color.jpg",
                  },
                },
              }),
            }),
            classificationType: Cesium.ClassificationType.TERRAIN,
          })
        );
        //Sandcastle_End
        Sandcastle.finishedLoading();
      }
      if (typeof Cesium !== "undefined") {
        window.startupCalled = true;
        startup(Cesium);
      }
    </script>
  </body>
</html>
