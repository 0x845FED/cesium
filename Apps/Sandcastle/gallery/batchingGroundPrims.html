<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <meta name="description" content="Use Viewer to start building new applications or easily embed Cesium into existing applications.">
    <meta name="cesium-sandcastle-labels" content="Beginner, Showcases">
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script type="text/javascript" src="../../../ThirdParty/requirejs-2.1.20/require.js"></script>
    <script type="text/javascript">
        if(typeof require === "function") {
            require.config({
                baseUrl : '../../../Source',
                waitSeconds : 120
            });
        }
    </script>
</head>
<body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html">
<style>
    @import url(../templates/bucket.css);
</style>
<div id="cesiumContainer" class="fullSize"></div>
<div id="loadingOverlay"><h1>Loading...</h1></div>
<div id="toolbar"></div>
<script id="cesium_sandcastle_script">
function startup(Cesium) {
    'use strict';
//Sandcastle_Begin

var worldTerrain = Cesium.createWorldTerrain({
    requestWaterMask: true,
    requestVertexNormals: true
});

var viewer = new Cesium.Viewer('cesiumContainer', {
    selectionIndicator: false,
    terrainProvider: worldTerrain
});
/*
viewer.extend(Cesium.viewerCesium3DTilesInspectorMixin);
var inspectorViewModel = viewer.cesium3DTilesInspector.viewModel;
*/
var scene = viewer.scene;

viewer.scene.globe.depthTestAgainstTerrain = true;
viewer.scene.copyGlobeDepth = true;

function offsetPositions(positions, degreeOffset) {
    positions = scene.globe.ellipsoid.cartesianArrayToCartographicArray(positions);
    var delta = Cesium.Math.toRadians(degreeOffset);
    for (var i = 0; i < positions.length; ++i) {
        var position = positions[i];
        position.latitude += delta;
        position.longitude += delta;
    }
    return scene.globe.ellipsoid.cartographicArrayToCartesianArray(positions);
}

var positions = [new Cesium.Cartesian3(-2358138.847340281, -3744072.459541374, 4581158.5714175375),
                new Cesium.Cartesian3(-2357231.4925370603, -3745103.7886602185, 4580702.9757762635),
                new Cesium.Cartesian3(-2355912.902205431, -3744249.029778454, 4582402.154378103),
                new Cesium.Cartesian3(-2357208.0209552636, -3743553.4420488174, 4581961.863286629)];

var concavePositions = [
    new Cesium.Cartesian3(-2353381.4891308164, -3747386.1222378365, 4577999.291515961),
    new Cesium.Cartesian3(-2359513.937204245, -3743087.2343810294, 4578357.188560644),
    new Cesium.Cartesian3(-2356102.0286082155, -3739921.552293276, 4582670.218770547),
    new Cesium.Cartesian3(-2353889.0353209395, -3741183.2274413602, 4582776.909071608),
    new Cesium.Cartesian3(-2355072.390487758, -3742865.615615464, 4580808.044684757),
    new Cesium.Cartesian3(-2356109.6661414686, -3741994.0607898533, 4580985.489703348),
    new Cesium.Cartesian3(-2357041.8328847606, -3743225.9693035223, 4579509.2148039425),
    new Cesium.Cartesian3(-2354586.752280607, -3744890.9511893727, 4579411.591389144),
    new Cesium.Cartesian3(-2353213.0268325945, -3743712.1202877173, 4581070.08828045),
    new Cesium.Cartesian3(-2353637.930711704, -3743402.9513476435, 4581104.219550749),
    new Cesium.Cartesian3(-2352875.095159641, -3742564.819171856, 4582173.540953957),
    new Cesium.Cartesian3(-2350669.646050987, -3743751.6823160048, 4582334.8406995395)
];

// concave polygon
var redPolygon1 = viewer.entities.add({
    name : 'concave polygon on surface',
    polygon : {
        hierarchy : offsetPositions(concavePositions, 0.0),
        material : '../images/Cesium_Logo_Color.jpg'
    }
});

// polygons with non-overlapping extents seem to be batchable without problems
/*
var redPolygon1 = viewer.entities.add({
    name : 'Red polygon on surface',
    polygon : {
        hierarchy : offsetPositions(positions, 0.0),
        material : Cesium.Color.RED.withAlpha(0.5)
    }
});

var redPolygon2 = viewer.entities.add({
    name : 'Red polygon on surface',
    polygon : {
        hierarchy : offsetPositions(positions, -0.01),
        material : Cesium.Color.GREEN.withAlpha(0.5)
    }
});

var redPolygon3 = viewer.entities.add({
    name : 'Red polygon on surface',
    polygon : {
        hierarchy : offsetPositions(positions, 0.01),
        material : Cesium.Color.BLUE.withAlpha(0.5)
    }
});

var redPolygon4 = viewer.entities.add({
    name : 'Red polygon on surface',
    polygon : {
        hierarchy : offsetPositions(positions, 0.02),
        material : '../images/Cesium_Logo_Color.jpg'
    }
});

var redPolygon5 = viewer.entities.add({
    name : 'Red polygon on surface',
    polygon : {
        hierarchy : offsetPositions(positions, 0.03),
        material :
        new Cesium.CheckerboardMaterialProperty({
            evenColor : Cesium.Color.WHITE,
            oddColor : Cesium.Color.BLACK,
            repeat : new Cesium.Cartesian2(4, 4)
        })
    }
});*/

// nearly overlapping rectangles over mt. st. helens
/*
var latitude = 46.1922;
var longitude = -122.1934;

viewer.entities.add({
    rectangle : {
        coordinates : Cesium.Rectangle.fromDegrees(longitude + 0.001, latitude + 0.001, longitude + 0.2, latitude + 0.2),
        material : Cesium.Color.BLUE.withAlpha(0.5)
    }
});

viewer.entities.add({
    rectangle : {
        coordinates : Cesium.Rectangle.fromDegrees(longitude - 0.2, latitude + 0.001, longitude, latitude + 0.2),
        material : Cesium.Color.GREEN.withAlpha(0.5)
    }
});

viewer.entities.add({
    rectangle : {
        coordinates : Cesium.Rectangle.fromDegrees(longitude - 0.2, latitude - 0.2, longitude, latitude),
        material : Cesium.Color.RED.withAlpha(0.5)
    }
});

viewer.entities.add({
    rectangle : {
        coordinates : Cesium.Rectangle.fromDegrees(longitude + 0.001, latitude - 0.2, longitude + 0.2, latitude),
        material : Cesium.Color.YELLOW.withAlpha(0.5)
    }
});
*/
var rightHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);
rightHandler.setInputAction(function(movement) {
    var cartesian = viewer.camera.pickEllipsoid(movement.position, scene.globe.ellipsoid);
    if (cartesian) {
        var cartographic = Cesium.Cartographic.fromCartesian(cartesian);
        var lat = Cesium.Math.toDegrees(cartographic.latitude);
        var long = Cesium.Math.toDegrees(cartographic.longitude);

        var normalized = Cesium.Cartesian3.normalize(cartesian, cartesian);
        console.log(normalized);

        viewer.entities.removeAll();
        viewer.entities.add({
            name : lat + ' ' + long,
            rectangle : {
                coordinates : Cesium.Rectangle.fromDegrees(long - 0.2, lat - 0.1, long + 0.2, lat + 0.1),
                material :
                new Cesium.CheckerboardMaterialProperty({
                    evenColor : Cesium.Color.ORANGE,
                    oddColor : Cesium.Color.YELLOW,
                    repeat : new Cesium.Cartesian2(14, 14)
                })
            }
        });
    }
}, Cesium.ScreenSpaceEventType.RIGHT_CLICK);

var leftHandler = new Cesium.ScreenSpaceEventHandler(scene.canvas);
leftHandler.setInputAction(function(movement) {
    var cartesian = viewer.camera.pickEllipsoid(movement.position, scene.globe.ellipsoid);
    if (cartesian) {
        console.log('new Cesium.Cartesian3(' + cartesian.x + ', ' + cartesian.y + ', ' + cartesian.z + '),');
    }
}, Cesium.ScreenSpaceEventType.LEFT_CLICK);

viewer.zoomTo(viewer.entities);

//Sandcastle_End
    Sandcastle.finishedLoading();
}
if (typeof Cesium !== "undefined") {
    startup(Cesium);
} else if (typeof require === "function") {
    require(["Cesium"], startup);
}
</script>
</body>
</html>
