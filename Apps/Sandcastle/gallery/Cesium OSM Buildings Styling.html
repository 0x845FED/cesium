<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta
      name="description"
      content="Use 3D Tiles Styling to assign colors based on material or find all office buildings."
    />
    <meta name="cesium-sandcastle-labels" content="Beginner, 3D Tiles" />
    <title>Cesium Demo</title>
    <script type="text/javascript" src="../Sandcastle-header.js"></script>
    <script
      type="text/javascript"
      src="../../../Build/CesiumUnminified/Cesium.js"
      nomodule
    ></script>
    <script type="module" src="../load-cesium-es6.js"></script>
  </head>

  <body
    class="sandcastle-loading"
    data-sandcastle-bucket="bucket-requirejs.html"
  >
    <style>
      @import url(../templates/bucket.css);
    </style>
    <div id="cesiumContainer" class="fullSize"></div>
    <div id="loadingOverlay">
      <h1>Loading...</h1>
    </div>
    <div id="toolbar"></div>
    <script id="cesium_sandcastle_script">
      function startup(Cesium) {
        "use strict";
        //Sandcastle_Begin
        var viewer = new Cesium.Viewer("cesiumContainer", {
          terrainProvider: Cesium.createWorldTerrain(),
        });

        // Create the OSM buildings
        var osmBuildingsTileset = Cesium.createOsmBuildings();
        viewer.scene.primitives.add(osmBuildingsTileset);

        // Set the initial camera to look at Seattle
        viewer.scene.camera.flyTo({
          destination: Cesium.Cartesian3.fromDegrees(-122.3472, 47.598, 370),
          orientation: {
            heading: Cesium.Math.toRadians(10),
            pitch: Cesium.Math.toRadians(-10),
          },
        });

        // Styling functions

        // Color by material checks for null values since not all
        // buildings have the material property.
        function colorByMaterial() {
          osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
            defines: {
              material: "${feature['building:material']}",
            },
            color: {
              conditions: [
                ["${material} === null", "color('white')"],
                ["${material} === 'glass'", "color('skyblue', 0.5)"],
                ["${material} === 'concrete'", "color('grey')"],
                ["${material} === 'brick'", "color('indianred')"],
                ["${material} === 'stone'", "color('lightslategrey')"],
                ["${material} === 'metal'", "color('lightgrey')"],
                ["${material} === 'steel'", "color('lightsteelblue')"],
                ["true", "color('white')"], // This is the else case
              ],
            },
          });
        }

        function highlightAllResidentialBuildings() {
          osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
            color: {
              conditions: [
                [
                  "${feature['building']} === 'apartments' || ${feature['building']} === 'residential'",
                  "color('cyan', 0.9)",
                ],
                [true, "color('white')"],
              ],
            },
          });
        }

        // Considering the Space Needle as the central point, colors are assigned to buildings based
        // on their distance to this central point. Get the latitude and longitude of a building by
        // clicking on a building and looking at its metadata.
        function colorByDistanceToSpaceNeedle() {
          osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
            defines: {
              distance:
                "distance(vec2(${feature['cesium#longitude']}, ${feature['cesium#latitude']}), vec2(-122.34931, 47.62051))",
            },
            color: {
              conditions: [
                ["${distance} > 0.014", "color('blue')"],
                ["${distance} > 0.010", "color('green')"],
                ["${distance} > 0.006", "color('yellow')"],
                ["${distance} > 0.0001", "color('red')"],
                ["true", "color('white')"],
              ],
            },
          });
        }

        function showByBuildingType(buildingType) {
          switch (buildingType) {
            case "office":
              osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                show: "${feature['building']} === 'office'",
              });
              break;
            case "apartments":
              osmBuildingsTileset.style = new Cesium.Cesium3DTileStyle({
                show: "${feature['building']} === 'apartments'",
              });
              break;
            default:
              break;
          }
        }

        // Dropdown menu for styling options
        Sandcastle.addToolbarMenu([
          {
            text: "Color By Building Material",
            onselect: function () {
              colorByMaterial();
            },
          },
          {
            text: "Color By Distance To Space Needle",
            onselect: function () {
              colorByDistanceToSpaceNeedle();
            },
          },
          {
            text: "Highlight Residential Buildings",
            onselect: function () {
              highlightAllResidentialBuildings();
            },
          },
          {
            text: "Show Office Buildings Only",
            onselect: function () {
              showByBuildingType("office");
            },
          },
          {
            text: "Show Apartment Buildings Only",
            onselect: function () {
              showByBuildingType("apartments");
            },
          },
        ]);

        colorByMaterial();

        //Sandcastle_End
        Sandcastle.finishedLoading();

        // To learn more about Cesium OSM Buildings such as properties and metadata,
        // visit  https://cesium.com/content/cesium-osm-buildings/
      }
      if (typeof Cesium !== "undefined") {
        window.startupCalled = true;
        startup(Cesium);
      }
    </script>
  </body>
</html>
